"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[682],{34738:(e,t,n)=>{n.r(t),n.d(t,{EnhancedPlaylist:()=>F,default:()=>Q});var a=n(20657),l=n(67294),i=n.n(l),r=n(30947),s=n(67379),c=n(55911),o=n(20246),m=n(18261),u=n(58548),d=n(76343),p=n(43620),g=n(59713),y=n.n(g),E=n(47991),b=n(56705),f=n(80624),h=n(98269),w=n(94967),v=n(69518),x=n.n(v),k=n(9273),C=n(36447);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){y()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e){const t=(0,k._)(),{isEnhanced:n,iteration:a,setIsEnhanced:i,toggleIsEnhanced:r}=(0,C.U)(e),[s,c]=(0,l.useState)(null),o=(0,l.useCallback)((async({itemId:n})=>{if(!s||!a)return;const{enhancePage:l,status:i}=await t.addRecommendation(e,s.sessionId,s.contextRevision,n);409===i||c(l)}),[s,e,t,a]),m=(0,l.useCallback)((async({itemId:n})=>{if(!s||!a)return;const{enhancePage:l,status:i}=await t.removeRecommendation(e,s.sessionId,s.contextRevision,n,!0);409===i||c(l)}),[s,e,t,a]),u=(0,l.useMemo)((()=>new w.Ct),[]),d=(0,l.useCallback)((async(n,l)=>{if(!a)return[];const i=await t.getPage(e,a,n,l);if(!i)return c(null),[];c(i);const r=Array.from(new Set(i.pageItems.map((e=>e.uri)))).filter((e=>!u.has(e)));return(await(0,b.s)(r,(async e=>{const{body:t}=await h.fQ.getTracks(f.b.getInstance(),e.map((e=>x().from(e).getBase62Id())));return t.tracks}))).flat().forEach((e=>u.set((0,E.$V)(e),e))),s=u,i.pageItems.map((e=>{var t;return O(O({},s.get(e.uri)),{},{uid:null==e?void 0:e.itemId,isEnhanced:null==e||null===(t=e.itemAttributes)||void 0===t?void 0:t.enhancedRec})}));var s}),[u,e,t,a]);return{isEnhanced:n,setIsEnhanced:i,toggleIsEnhanced:r,addRecommendation:o,removeRecommendation:m,playContext:(0,l.useMemo)((()=>({uri:e,url:null==s?void 0:s.dspContextUri})),[e,null==s?void 0:s.dspContextUri]),numTotalItems:isNaN(Number(null==s?void 0:s.numTotalItems))?void 0:Number(null==s?void 0:s.numTotalItems),fetchTracks:d,contextRevision:null==s?void 0:s.contextRevision}}var j=n(84242),T=n(95661),N=n(35410),R=n(70369),_=n(37338),L=n(42273),D=n(59482),S=n(72907),U=n(67892),$=n(55120),z=n(24172);const B={xs:"(min-width: 0px)",xsOnly:"(min-width: 0px) and (max-width: 767px)",sm:"(min-width: 768px)",smOnly:"(min-width: 768px) and (max-width: 1023px)",md:"(min-width: 1024px)",mdOnly:"(min-width: 1024px) and (max-width: 1279px)",lg:"(min-width: 1280px)",lgOnly:"(min-width: 1280px) and (max-width: 1919px)",xl:"(min-width: 1920px)",enhancedPlaylist:"HX0u0G8bBbI9FFQE9JW5",playlistImageContainer:"_6eIkE1hgff_QOJxjB_H"},F=i().memo((function({metadata:e}){const{uri:t,name:n,description:g,images:y,totalLength:E,totalLikes:b,owner:f,isOwnedBySelf:h,isCollaborative:w,canPlay:v}=e,x=h,k=(0,l.useMemo)((()=>[{id:f.username,uri:f.uri,name:f.username,displayName:f.displayName||void 0,images:f.images}]),[f]),[C]=y,I=(0,p.Z)((null==C?void 0:C.url)||null),O=(0,l.useContext)(z.zy),F=(0,l.useCallback)((e=>{O({type:"open",playlistDetails:{name:n,description:g,image:C,uri:t},focusedElement:e})}),[O,n,g,C,t]),Q=(0,l.useCallback)((()=>{O({type:"openWithImagePicker",playlistDetails:{name:n,description:g,image:C,uri:t}})}),[O,n,g,C,t]),{playContext:X,numTotalItems:M}=P(t),{isPlaying:W,togglePlay:q}=(0,j.n)(X,{featureIdentifier:"playlist"}),A=(0,l.useCallback)((()=>q()),[q]);return i().createElement(l.Suspense,{fallback:null},i().createElement(R.$,null,a.ag.get("playlist.page-title",n)),i().createElement("section",{role:"presentation",className:B.enhancedPlaylist,"data-testid":"enhanced-playlist-page"},i().createElement(L.gF,{backgroundColor:I},i().createElement(D.W,null,i().createElement($.$,{size:c.qE.sm,onClick:A,isPlaying:W,uri:t}),i().createElement(S.i,{text:n,dragUri:t,dragLabel:n})),i().createElement(m._,{menu:i().createElement(N.X,{uri:t})},i().createElement("div",{className:B.playlistImageContainer},i().createElement(_.T,{canEdit:x,name:n,images:y,onClick:Q,placeholderType:"playlist",dragUri:t}))),i().createElement(L.sP,null,i().createElement(L.dy,{small:!0,uppercase:!0},w?a.ag.get("sidebar.collaborative_playlist"):a.ag.get("playlist")),i().createElement(m._,{menu:i().createElement(N.X,{uri:t})},i().createElement(L.xd,{canEdit:x,onClick:()=>F(z.w.TITLE),dragUri:t,dragLabel:n,ariaLabel:a.ag.get("playlist.edit-details.button",n)},n)),g&&i().createElement(L.dy,{bold:!1,gray:!0},i().createElement(u.kf,{paragraphClassName:B.playlistDescription,source:g,LinkComponent:U.r,variant:d.$e.viola})),i().createElement(L.QS,{creators:k,totalTracks:null!=M?M:E,totalLikes:b||0}))),i().createElement("div",{className:B.playlistContent},i().createElement(r.o,{backgroundColor:I},i().createElement(r.F,null,v?i().createElement($.$,{onClick:A,isPlaying:W,size:c.qE.lg,uri:t}):null,i().createElement(s.v,{uri:t}),i().createElement(o.y,{menu:i().createElement(N.X,{uri:t})},i().createElement(T.z,null)))))))})),Q=F}}]);
//# sourceMappingURL=xpui-routes-enhanced-playlist.js.map